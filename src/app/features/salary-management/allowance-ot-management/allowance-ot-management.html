<div class="salary-ot-page">
  <!-- Title -->
  <h2 class="page-title">Quản lý phụ cấp & OT</h2>
  <p class="page-desc">
    Nhập phụ cấp và số giờ OT cho nhân viên –
    Tháng {{ currentMonth }}/{{ currentYear }}
  </p>

  <div class="content-layout">

    <!-- Left Content -->
    <div class="main-table">

      <div class="table-header">
        <h3>Danh sách nhân viên</h3>
        <input
          type="text"
          class="search-input"
          placeholder="Tìm kiếm..."
          [(ngModel)]="searchText"
          (input)="filter()"
        />
      </div>

      <p class="sub-desc">Nhập phụ cấp và số giờ OT cho từng nhân viên</p>

      <table class="employee-table">
        <thead>
          <tr>
            <th>Nhân viên</th>
            <th>Lương cơ bản</th>
            <th>Phụ cấp</th>
            <th>OT (giờ)</th>
            <th>Tổng lương</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let emp of filteredEmployees">
            <!-- Nhân viên -->
            <td>
              <div class="employee-info">
                <div class="avatar"><i class="ri-user-3-fill"></i></div>
                <div class="info">
                  <span class="name">{{ emp.tenNhanVien }}</span>
                  <span class="email">{{ emp.email }}</span>
                </div>
              </div>
            </td>

            <!-- Lương cơ bản -->
          
            <td>{{ emp.luongCoBan | number:'1.0-0' }}</td>

           <td class="editable-cell">
            <input
              type="number"
              [(ngModel)]="emp.phuCap"
              (input)="updateSummary()"
       (blur)="autoSave(emp)" />
           
            <i class="ri-edit-line edit-icon"></i>
          </td>

          <td class="editable-cell">
            <input
              type="number"
              [(ngModel)]="emp.ot"
              (input)="updateSummary()"(blur)="autoSave(emp)" 
            />
            <i class="ri-edit-line edit-icon"></i>
          </td>


            <!-- Tổng lương -->
            <td class="total">
              {{
                emp.luongCoBan + emp.phuCap + emp.ot * 30000
                  | number:'1.0-0'
              }}đ
            </td>
          </tr>
        </tbody>
      </table>

      <div class="table-footer">
        Hiển thị {{ filteredEmployees.length }} nhân viên
      </div>

    </div>

    <!-- Side Panel -->
    <div class="side-panel">

      <div class="card highlight">
        <h4>Tổng phụ cấp nhân viên</h4>
        <p class="value">{{ totalAllowance | number:'1.0-0' }} đ</p>
      </div>

      <div class="card info">
        <h4>Thống kê nhanh</h4>
        <p>Lương cơ bản trung bình: {{ avgSalary | number:'1.0-0' }} k/h</p>
        <p>Phụ cấp trung bình: {{ avgAllowance | number:'1.0-0' }} đ</p>
        <p>OT trung bình: {{ avgOt | number:'1.0-0' }} giờ</p>
      </div>

      

    </div>

  </div>

</div>

<!-- TOAST THÔNG BÁO -->
@if (toastVisible) {
  <div class="toast" [ngClass]="toastType">
    {{ toastMessage }}
  </div>
}

